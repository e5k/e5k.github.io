---
layout: post
title: TephraProb v.1.6
categories: codes
tags: tephraprob release
---

There has been a change in the access to the Google Map API used by the function [plot_google_map](https://au.mathworks.com/matlabcentral/fileexchange/27627-zoharby-plot_google_map) by Zohar Bar-Yehuda that can cause problems when TephraProb attempts to retrieve the map background. Google now requires to get an API Key, which needs to be associated with a Google Project and, tadaaaa, a billing account. Although this is likely to remain free for a small number of requests, some might be reluctant to add a billing account to get a key. A new function offering to export maps to Google Earth was therefore implemented, which relies on the [Google Earth Toolbox](https://au.mathworks.com/matlabcentral/fileexchange/12954-google-earth-toolbox) by Scott Lee Davis.

## Changes in TephraProb v1.6
### TephraProb preferences
The preference pannel has been reworked. Regarding Google Maps, the options are:
- Choose whether a basemap should be plotted. The option for Google Map  remains, knowing that problems may occur if not used with an API Key;
- Enter an API Key for Google Map, which is likely to solve the problems.

Regarding Google Earth, the options are:
- Choose to export the set of plotted data to Google Earth. If selected, this option saves a <pth>.kmz</pth> file in <pth>RunName/RunNb/KML/</pth>;
- Choose to display the <pth>.kmz</pth> upon completion of the generation of the maps. Note that this process will attempt to open the <pth>.kmz</pth> file with the default software assigned in your system for this file extension. If your computer opens another software, you must manually change the default software used for <pth>.kmz</pth> files.

### Google Earth output file
If the option described above is selected, TephraProb will generate a Google Earth file upon completion of the <cmd>Display / Probability maps</cmd> and <cmd>Display / Isomass maps</cmd> functions. The Google Earth file generated by TephraProb is a *KMZ* file, which is an archive containing all the associated files required for display that can easily be shared amongst people. Once opened, the file contains:
- Each map selected for plotting in TephraProb;
- A color bar;
- The extent of the original computation grid. Note that some re-interpolation is necessary to plot the maps in Google Earth and some data may appear outside the computation domain. **This is an artefact** and should be considered as such;
- The vent.

Additionaly, if i) hazard curves have been computed for the working project , ii) the option <cmd>Plot hazard curve location</cmd> is activated in the preferences and iii) probability maps are being plotted, TephraProb adds the location of the hazard curves in the <pth>.kmz</pth> file. These points are clickable and will display the hazard curves.

### Added dependency
- Function [Google Earth Toolbox](https://au.mathworks.com/matlabcentral/fileexchange/12954-google-earth-toolbox) by Scott Lee Davis.
